# üîç Troubleshooting Error 405 en Vercel

## üö® Problema Actual
```
Failed to load resource: the server responded with a status of 405 ()
```

## üîß Pasos de Diagn√≥stico

### 1. Verificar Funciones Serverless
```bash
# Despu√©s del deploy, verifica que las funciones est√©n activas
# Ve a: https://vercel.com/dashboard/[tu-proyecto]/functions
```

### 2. Probar Endpoints Manualmente
```bash
# Probar endpoint de debug
curl https://tu-app.vercel.app/api/debug

# Probar endpoint de hello
curl https://tu-app.vercel.app/api/hello

# Probar auth endpoint
curl -X POST https://tu-app.vercel.app/api/auth/login \
  -H "Content-Type: application/json" \
  -d '{"email":"test@example.com","password":"123"}'
```

### 3. Verificar Logs de Vercel
1. Ve al dashboard de Vercel
2. Selecciona tu proyecto
3. Ve a "Functions" ‚Üí "View Function Logs"
4. Busca errores espec√≠ficos

## üêõ Posibles Causas y Soluciones

### Causa 1: Funciones No Detectadas
**S√≠ntoma**: Las funciones no aparecen en el dashboard de Vercel

**Soluci√≥n**:
```json
// vercel.json
{
  "functions": {
    "api/**/*.js": {
      "maxDuration": 30
    }
  }
}
```

### Causa 2: M√©todo HTTP Incorrecto
**S√≠ntoma**: Error 405 en endpoints espec√≠ficos

**Verificar**:
- Frontend est√° enviando el m√©todo correcto
- Funci√≥n serverless maneja el m√©todo correcto

### Causa 3: CORS Issues
**S√≠ntoma**: Error 405 en preflight requests

**Soluci√≥n**: Asegurar que todas las funciones manejen OPTIONS:
```javascript
if (req.method === 'OPTIONS') {
  res.status(200).end();
  return;
}
```

### Causa 4: Rutas Incorrectas
**S√≠ntoma**: Error 405 en todas las rutas

**Verificar**:
- Archivos est√°n en `/api/`
- Nombres de archivos coinciden con rutas
- `vercel.json` tiene rewrites correctos

## üìã Checklist de Verificaci√≥n

### ‚úÖ Configuraci√≥n de Archivos
- [ ] `vercel.json` en la ra√≠z del proyecto
- [ ] Funciones en directorio `/api/`
- [ ] Todas las funciones usan `export default`
- [ ] `package.json` tiene `"type": "module"`

### ‚úÖ Funciones Serverless
- [ ] `/api/hello.js` - Endpoint de prueba
- [ ] `/api/debug.js` - Endpoint de debug
- [ ] `/api/auth/login.js` - Login
- [ ] `/api/auth/register.js` - Registro
- [ ] `/api/auth/logout.js` - Logout
- [ ] `/api/databases.js` - Bases de datos
- [ ] `/api/database.js` - Base espec√≠fica
- [ ] `/api/test-connection.js` - Test conexi√≥n

### ‚úÖ Manejo de CORS
- [ ] Headers CORS en `vercel.json`
- [ ] Headers CORS en cada funci√≥n
- [ ] Manejo de OPTIONS requests

### ‚úÖ M√©todos HTTP
- [ ] Cada funci√≥n valida el m√©todo correcto
- [ ] Respuestas 405 para m√©todos incorrectos
- [ ] Manejo de preflight OPTIONS

## üîç Debugging Avanzado

### 1. Crear Funci√≥n de Test Simple
```javascript
// api/test-simple.js
export default function handler(req, res) {
  res.json({ 
    message: 'Simple test working',
    method: req.method,
    url: req.url,
    timestamp: new Date().toISOString()
  });
}
```

### 2. Verificar Variables de Entorno
```javascript
// api/env-test.js
export default function handler(req, res) {
  res.json({
    nodeEnv: process.env.NODE_ENV,
    vercelRegion: process.env.VERCEL_REGION,
    vercelFunction: process.env.VERCEL_FUNCTION_NAME
  });
}
```

### 3. Logs Detallados
```javascript
// Agregar a cada funci√≥n
console.log('üîç Function called:', {
  method: req.method,
  url: req.url,
  headers: req.headers,
  timestamp: new Date().toISOString()
});
```

## üöÄ Pasos de Despliegue

### 1. Preparar C√≥digo
```bash
git add .
git commit -m "Fix Vercel 405 error - troubleshooting"
git push
```

### 2. Verificar Deploy
```bash
# Esperar a que termine el deploy
# Verificar en dashboard de Vercel
```

### 3. Probar Endpoints
```bash
# Probar debug endpoint
curl https://tu-app.vercel.app/api/debug

# Si funciona, probar auth
curl -X POST https://tu-app.vercel.app/api/auth/login \
  -H "Content-Type: application/json" \
  -d '{"email":"test","password":"test"}'
```

## üìû Si el Problema Persiste

1. **Revisar logs completos** en Vercel dashboard
2. **Verificar que el deploy fue exitoso**
3. **Probar endpoints uno por uno**
4. **Verificar que las funciones aparecen en el dashboard**
5. **Contactar soporte de Vercel** si es necesario

## üéØ Pr√≥ximos Pasos

Una vez que identifiquemos la causa espec√≠fica:
1. Aplicar la soluci√≥n correspondiente
2. Hacer nuevo deploy
3. Verificar que funciona
4. Documentar la soluci√≥n para futuras referencias 