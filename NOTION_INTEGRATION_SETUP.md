# üîó Integraci√≥n Completa con Notion

## üìã Configuraci√≥n Requerida

### 1. Variables de Entorno

Crea un archivo `.env` en la ra√≠z del proyecto con las siguientes variables:

```env
# Notion API Configuration
NOTION_TOKEN=your_notion_integration_token_here
NOTION_LEADS_DATABASE_ID=your_leads_database_id_here

# Opcional: Para desarrollo local
VITE_API_BASE_URL=http://localhost:3000/api
```

### 2. Configuraci√≥n de la Base de Datos de Notion

Tu base de datos de leads debe tener las siguientes propiedades:

#### **Propiedades Requeridas:**
- **Email** (Email) - Email del usuario
- **Nombre** (Title) - Nombre del usuario
- **Estado** (Select) - Estados: Pending, Approved, Rejected, Admin
- **Fecha de Registro** (Date) - Fecha de registro

#### **Propiedades Opcionales:**
- **Empresa** (Rich Text) - Empresa del usuario
- **Rol/Cargo** (Select) - Cargo o rol profesional
- **Descripci√≥n** (Rich Text) - Descripci√≥n del usuario
- **Fuente** (Select) - Origen del lead (Landing Page, Demo, etc.)
- **Notas** (Rich Text) - Notas del administrador

### 3. Configuraci√≥n del Token de Notion

1. Ve a [https://www.notion.so/my-integrations](https://www.notion.so/my-integrations)
2. Crea una nueva integraci√≥n
3. Dale permisos de lectura y escritura a la base de datos de leads
4. Copia el token y agr√©galo a tu `.env`

### 4. Obtener el ID de la Base de Datos

1. Abre tu base de datos de leads en Notion
2. Copia la URL
3. El ID est√° en la URL: `https://notion.so/workspace/[DATABASE_ID]?v=...`

## üöÄ Funcionalidades Implementadas

### ‚úÖ **Verificaci√≥n de Estado en Tiempo Real**
- Los usuarios pueden verificar su estado desde la p√°gina de login
- Se conecta directamente con Notion para obtener el estado actual
- Fallback a datos simulados si hay problemas de conexi√≥n

### ‚úÖ **Panel de Administraci√≥n Completo**
- Vista de todos los usuarios desde Notion
- Estad√≠sticas en tiempo real
- Cambio de roles con actualizaci√≥n autom√°tica en Notion
- Sistema de notas para rechazos
- Interfaz moderna y responsive

### ‚úÖ **Sincronizaci√≥n Bidireccional**
- Los cambios en el panel se reflejan inmediatamente en Notion
- Los cambios en Notion se reflejan en el panel al actualizar
- Sistema de fallback robusto

## üîß Comandos de Desarrollo

```bash
# Iniciar servidor de desarrollo
npm run dev

# Construir para producci√≥n
npm run build

# Desplegar en Vercel
vercel --prod
```

## üß™ Testing

### Usuarios de Prueba:
- **demo@example.com** - Aprobado
- **test@example.com** - Pendiente
- **admin@example.com** - Administrador
- **rejected@example.com** - Rechazado

### Flujo de Prueba:
1. Ve a `/admin` como admin@example.com
2. Cambia el estado de test@example.com a "approved"
3. Verifica que el cambio se refleje en las estad√≠sticas
4. Prueba el sistema de notas al rechazar un usuario

## üìä Monitoreo

### Logs del Servidor:
- ‚úÖ Usuarios cargados desde Notion
- ‚úÖ Estado actualizado en Notion
- ‚ùå Errores de conexi√≥n con Notion
- üìù Notas del administrador

### M√©tricas Disponibles:
- Total de usuarios
- Usuarios pendientes
- Usuarios aprobados
- Usuarios rechazados
- Administradores

## üîí Seguridad

### Validaciones Implementadas:
- Verificaci√≥n de roles antes de permitir acceso al panel
- Validaci√≥n de estados permitidos
- Sanitizaci√≥n de datos de entrada
- Manejo de errores de autenticaci√≥n

### Permisos de Notion:
- Solo lectura y escritura en la base de datos espec√≠fica
- No acceso a otras p√°ginas o bases de datos
- Token con permisos m√≠nimos necesarios

## üö® Troubleshooting

### Error: "Token de Notion inv√°lido"
- Verifica que el token est√© correcto en `.env`
- Aseg√∫rate de que la integraci√≥n tenga permisos en la base de datos

### Error: "Base de datos no encontrada"
- Verifica que el `NOTION_LEADS_DATABASE_ID` sea correcto
- Aseg√∫rate de que la integraci√≥n tenga acceso a la base de datos

### Error: "Configuraci√≥n de base de datos no encontrada"
- Verifica que todas las variables de entorno est√©n configuradas
- Reinicia el servidor despu√©s de cambiar las variables

### Datos de Fallback:
Si hay problemas de conexi√≥n con Notion, el sistema usa datos simulados para mantener la funcionalidad.

## üìà Pr√≥ximos Pasos

1. **Notificaciones por Email** - Enviar emails autom√°ticos cuando se apruebe/rechace un usuario
2. **Webhooks de Notion** - Recibir actualizaciones en tiempo real desde Notion
3. **Analytics Avanzados** - M√©tricas de conversi√≥n y tiempo de respuesta
4. **Filtros y B√∫squeda** - B√∫squeda avanzada en el panel de administraci√≥n
5. **Exportaci√≥n de Datos** - Exportar reportes en diferentes formatos 