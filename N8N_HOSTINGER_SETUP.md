# ðŸ”§ ConfiguraciÃ³n de n8n en Hostinger

## ðŸ“‹ Resumen

Este proyecto estÃ¡ configurado para usar **n8n en Hostinger** en lugar de un contenedor local. Esto significa que:

- âœ… **n8n estÃ¡ alojado en Hostinger** (no local)
- âœ… **Los webhooks se envÃ­an a tu n8n de Hostinger**
- âœ… **No necesitas ejecutar n8n localmente**

## ðŸ”§ ConfiguraciÃ³n de Variables

### Variables Requeridas

En tu archivo `.env`, configura estas variables:

```env
# URL de tu n8n en Hostinger
N8N_WEBHOOK_URL=https://tu-n8n-en-hostinger.com/webhook/linka

# Secret para verificar webhooks (debe coincidir con el configurado en n8n)
N8N_WEBHOOK_SECRET=8e723900-53ba-4198-a303-fef0224f2d0a
```

### Ejemplo de ConfiguraciÃ³n

```env
# Si tu n8n estÃ¡ en: https://n8n.tudominio.com
N8N_WEBHOOK_URL=https://n8n.tudominio.com/webhook/linka

# Secret que configurarÃ¡s en n8n
N8N_WEBHOOK_SECRET=tu-secret-super-seguro-123
```

## ðŸŽ¯ ConfiguraciÃ³n en n8n (Hostinger)

### 1. Crear Webhook en n8n

1. **Accede a tu n8n en Hostinger**
2. **Crea un nuevo workflow**
3. **Agrega un nodo Webhook**
4. **Configura:**
   - **HTTP Method**: POST
   - **Path**: `/webhook/linka`
   - **Response Mode**: Respond to Webhook

### 2. Configurar Secret de VerificaciÃ³n

En tu workflow de n8n, agrega un nodo **Code** despuÃ©s del webhook:

```javascript
// CÃ³digo para verificar el secret
const webhookData = $input.all()[0].json;
const expectedSecret = "tu-secret-super-seguro-123"; // Mismo que en .env

if (webhookData.secret !== expectedSecret) {
    throw new Error("Secret invÃ¡lido");
}

return {
    event: webhookData.event,
    data: webhookData.data,
    timestamp: webhookData.timestamp
};
```

### 3. Eventos Disponibles

#### ðŸ“§ `new_lead`
Se envÃ­a cuando alguien se registra en el landing page.

```json
{
  "event": "new_lead",
  "data": {
    "email": "usuario@ejemplo.com",
    "name": "Juan PÃ©rez",
    "company": "Empresa ABC",
    "role": "CEO",
    "description": "Interesado en el producto",
    "source": "Landing Page",
    "notionId": "23e23882-4ec5-8103-a078-c692ddcaedc4"
  },
  "timestamp": "2024-01-15T10:30:00.000Z",
  "secret": "tu-secret-super-seguro-123"
}
```

#### ðŸ”„ `user_status_changed`
Se envÃ­a cuando un admin cambia el estado de un usuario.

```json
{
  "event": "user_status_changed",
  "data": {
    "email": "usuario@ejemplo.com",
    "name": "Juan PÃ©rez",
    "oldStatus": "pending",
    "newStatus": "approved",
    "adminNotes": "Usuario aprobado para acceso",
    "notionId": "23e23882-4ec5-8103-a078-c692ddcaedc4"
  },
  "timestamp": "2024-01-15T10:30:00.000Z",
  "secret": "tu-secret-super-seguro-123"
}
```

#### ðŸ“¨ `invitation_created`
Se envÃ­a cuando se crea una invitaciÃ³n.

```json
{
  "event": "invitation_created",
  "data": {
    "email": "usuario@ejemplo.com",
    "invitedBy": 1,
    "invitationLink": "http://localhost:3000/register?token=abc123",
    "expiresAt": "2024-01-22T10:30:00.000Z"
  },
  "timestamp": "2024-01-15T10:30:00.000Z",
  "secret": "tu-secret-super-seguro-123"
}
```

#### ðŸ‘¤ `user_registered`
Se envÃ­a cuando un usuario completa su registro.

```json
{
  "event": "user_registered",
  "data": {
    "email": "usuario@ejemplo.com",
    "name": "Juan PÃ©rez",
    "role": "approved",
    "userId": 123
  },
  "timestamp": "2024-01-15T10:30:00.000Z",
  "secret": "tu-secret-super-seguro-123"
}
```

## ðŸŽ¯ Automatizaciones Recomendadas

### 1. Email de ConfirmaciÃ³n de Lead
```
Trigger: new_lead
â†’ Gmail/SendGrid
â†’ Template: "Gracias por tu interÃ©s"
```

### 2. Email de AprobaciÃ³n
```
Trigger: user_status_changed (newStatus = "approved")
â†’ Gmail/SendGrid
â†’ Template: "Tu solicitud ha sido aprobada"
```

### 3. Email de InvitaciÃ³n
```
Trigger: invitation_created
â†’ Gmail/SendGrid
â†’ Template: "Has sido invitado a Linka v2.0"
```

### 4. Email de Bienvenida
```
Trigger: user_registered
â†’ Gmail/SendGrid
â†’ Template: "Bienvenido a Linka v2.0"
```

### 5. NotificaciÃ³n al Admin
```
Trigger: new_lead
â†’ Gmail/SendGrid
â†’ Template: "Nuevo lead registrado"
```

## ðŸ§ª Testing

### 1. Probar Webhook Localmente

Puedes probar el webhook con este comando:

```bash
curl -X POST https://tu-n8n-en-hostinger.com/webhook/linka \
  -H "Content-Type: application/json" \
  -d '{
    "event": "new_lead",
    "data": {
      "email": "test@ejemplo.com",
      "name": "Usuario de Prueba",
      "company": "Empresa Test",
      "role": "CEO",
      "description": "Interesado en el producto",
      "source": "Landing Page",
      "notionId": "test-notion-id-123"
    },
    "timestamp": "2024-01-15T10:30:00.000Z",
    "secret": "tu-secret-super-seguro-123"
  }'
```

### 2. Verificar en n8n

1. **Ve a tu n8n en Hostinger**
2. **Abre el workflow del webhook**
3. **Ejecuta el comando de prueba**
4. **Verifica que llegue el webhook**

## ðŸ”’ Seguridad

- **Verifica el secret** en cada webhook
- **Usa HTTPS** para todas las conexiones
- **Valida los datos** antes de procesarlos
- **Maneja errores** apropiadamente

## ðŸ“Š Monitoreo

- **Logs de webhooks** en n8n
- **MÃ©tricas de emails** enviados
- **Estado de automatizaciones**
- **Errores y reintentos**

## ðŸ†˜ Troubleshooting

### Problema: Webhook no llega
1. **Verifica la URL** en `.env`
2. **Confirma que el secret coincida**
3. **Revisa los logs de n8n**
4. **Prueba con curl localmente**

### Problema: Secret invÃ¡lido
1. **Verifica que el secret en `.env` coincida con el de n8n**
2. **Revisa el nodo de verificaciÃ³n en n8n**
3. **AsegÃºrate de que no haya espacios extra**

### Problema: n8n no responde
1. **Verifica que n8n estÃ© funcionando en Hostinger**
2. **Revisa los logs de n8n**
3. **Confirma que el workflow estÃ© activo** 