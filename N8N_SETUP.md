# ðŸš€ ConfiguraciÃ³n de n8n con Webhooks

## ðŸ“‹ Variables de Entorno Necesarias

Agrega estas variables a tu archivo `.env`:

```env
# n8n Webhook Configuration
N8N_WEBHOOK_URL=https://tu-n8n-en-hostinger.com/webhook/linka
N8N_WEBHOOK_SECRET=tu-webhook-secret-super-seguro
```

## ðŸ”§ ConfiguraciÃ³n en n8n

### 1. Crear Webhook Trigger
1. Ve a tu n8n en Hostinger
2. Crea un nuevo workflow
3. Agrega un nodo **Webhook**
4. Configura:
   - **HTTP Method**: POST
   - **Path**: `/webhook/linka`
   - **Response Mode**: Respond to Webhook

### 2. Eventos Disponibles

#### ðŸ“§ `new_lead`
Se envÃ­a cuando alguien se registra en el landing page.

**Datos recibidos:**
```json
{
  "event": "new_lead",
  "data": {
    "email": "usuario@ejemplo.com",
    "name": "Juan PÃ©rez",
    "company": "Empresa ABC",
    "role": "CEO",
    "description": "Interesado en el producto",
    "source": "Landing Page",
    "notionId": "23e23882-4ec5-8103-a078-c692ddcaedc4"
  },
  "timestamp": "2024-01-15T10:30:00.000Z",
  "secret": "tu-webhook-secret"
}
```

#### ðŸ”„ `user_status_changed`
Se envÃ­a cuando un admin cambia el estado de un usuario.

**Datos recibidos:**
```json
{
  "event": "user_status_changed",
  "data": {
    "email": "usuario@ejemplo.com",
    "name": "Juan PÃ©rez",
    "oldStatus": "pending",
    "newStatus": "approved",
    "adminNotes": "Usuario aprobado para acceso",
    "notionId": "23e23882-4ec5-8103-a078-c692ddcaedc4"
  },
  "timestamp": "2024-01-15T10:30:00.000Z",
  "secret": "tu-webhook-secret"
}
```

#### ðŸ“¨ `invitation_created`
Se envÃ­a cuando se crea una invitaciÃ³n.

**Datos recibidos:**
```json
{
  "event": "invitation_created",
  "data": {
    "email": "usuario@ejemplo.com",
    "invitedBy": 1,
    "invitationLink": "http://localhost:3000/register?token=abc123",
    "expiresAt": "2024-01-22T10:30:00.000Z"
  },
  "timestamp": "2024-01-15T10:30:00.000Z",
  "secret": "tu-webhook-secret"
}
```

#### ðŸ‘¤ `user_registered`
Se envÃ­a cuando un usuario completa su registro.

**Datos recibidos:**
```json
{
  "event": "user_registered",
  "data": {
    "email": "usuario@ejemplo.com",
    "name": "Juan PÃ©rez",
    "role": "approved",
    "userId": 123
  },
  "timestamp": "2024-01-15T10:30:00.000Z",
  "secret": "tu-webhook-secret"
}
```

## ðŸŽ¯ Automatizaciones Recomendadas

### 1. Email de ConfirmaciÃ³n de Lead
```
Trigger: new_lead
â†’ Gmail/SendGrid
â†’ Template: "Gracias por tu interÃ©s"
```

### 2. Email de AprobaciÃ³n
```
Trigger: user_status_changed (newStatus = "approved")
â†’ Gmail/SendGrid
â†’ Template: "Tu solicitud ha sido aprobada"
```

### 3. Email de InvitaciÃ³n
```
Trigger: invitation_created
â†’ Gmail/SendGrid
â†’ Template: "Has sido invitado a Linka v2.0"
```

### 4. Email de Bienvenida
```
Trigger: user_registered
â†’ Gmail/SendGrid
â†’ Template: "Bienvenido a Linka v2.0"
```

### 5. NotificaciÃ³n al Admin
```
Trigger: new_lead
â†’ Gmail/SendGrid
â†’ Template: "Nuevo lead registrado"
```

## ðŸ”’ Seguridad

- **Verifica el secret** en cada webhook
- **Usa HTTPS** para todas las conexiones
- **Valida los datos** antes de procesarlos
- **Maneja errores** apropiadamente

## ðŸ§ª Testing

Para probar los webhooks:

1. **Configura las variables de entorno**
2. **Crea el webhook en n8n**
3. **Registra un lead** en el landing page
4. **Verifica que llegue el webhook** en n8n
5. **Configura las automatizaciones** de email

## ðŸ“Š Monitoreo

- **Logs de webhooks** en n8n
- **MÃ©tricas de emails** enviados
- **Estado de automatizaciones**
- **Errores y reintentos** 